@(fuzzySystem : FuzzySystem, tp : models.Type, newMFForm : Form[models.MF])

@import helper._

@main(fuzzySystem.name + " -> " + tp.name)(fuzzy.system.types.menu(fuzzySystem, tp.id)){ 
    

    <div class="sub_content sub_limited">
        <h3 class='sub_content_header'>New Membership Function</h3> 
            @helper.form(action = routes.MFs.create(fuzzySystem.id,tp.id), 'id -> "newMFForm") {
                
                <fieldset>
                    <legend>General Information for the new MF</legend>
                    
                    @inputText(
                        newMFForm("label"), 
                        '_label -> "Label", 
                        '_help -> "The label of this MF"
                    )                

                    
                    @select(
                        field = newMFForm("idFunction"),
                            options = options(models.MF.getMFTypes()),
                        '_label -> "Member Functions Type",
                        '_help -> "Select the function for this MF"
                    )                        
                </fieldset>           
                
                <fieldset>
                    <legend>Parameters</legend>

                    <div id="params">
                    </div>

                    @***

                    @repeat(newMFForm("params"), min = 3) { paramField =>
                        
                        @inputText(
                            paramField
                        )
                        
                    }   
                    
                        <dl class=" " id="params_0__field">
                            <dt><label for="params_0_">params[0]</label></dt>
                            <dd>
                            <input type="text" id="params_0_" name="params[0]" value="" >
                        </dd>

                    ***@
                
                <div class="actions">
                    <input type="submit" class="btn primary" value="Create">
                </div>
                
            }
 

    </div>
    <script type="text/javascript">

        $(document).ready(function() {

          $('#idFunction').change(getParamsForMf);
          getParamsForMf();
          //get parameters for a given mf type
          function getParamsForMf() {
            var idFunction = $('#idFunction');
            $.get('/ajax/get_num_params_mf',
                  {mf_key: idFunction.val()},
                  function(data) {
                    setParamsForMf(data);
                  });
          }

          /* set parameters for a given mf type
          adding to the form the number of input equivalent to 
          */
          function setParamsForMf(num_params) {
                var paramsDiv = $('#params');
                var paramsHTML = '';

                @if(newMFForm("params").hasErrors) {
                    @newMFForm("params").errors().map { error =>
                     paramsHTML += '<dd class="error">@error.message()</dd>'
                    }
                }
                
                for (var i = 0; i < num_params; i++) {
                    paramsHTML += getNewParamHtml(i);
                };
                //window.alert(paramsHTML);
                // paramsDiv.fadeIn('fast');
                paramsDiv.html($(paramsHTML).fadeIn('fast'));

            
          }

          /* Creates the html for the new param input and label*/
          function getNewParamHtml(i){
            var letter = String.fromCharCode(97 + i);
            var paramHTML ='<dl class="@if(newMFForm("params").hasErrors) {error} " id="params_ID__field">\
                               <dt><label for="params_ID_">Param.  LETTER</label></dt>\
                                <dd><input type="text" id="params_ID_" name="params[ID]" value="" ></dd>'


                paramHTML += '</dl>'; 

            paramHTML = paramHTML.replace(/ID/g, i);
            paramHTML = paramHTML.replace(/LETTER/g, letter);


            // var paramHTML =   '<dl class=" " id="params_'+i+'__field">';

            //     paramHTML +=  '<label for="params_'+i+'_">params['+i+']</label>';
            //     paramHTML +=  '<input type="text" id="params_'+ i +'_" name="params['+ i +']" value="">';
                return paramHTML;
          }



        });
                
    </script>
}